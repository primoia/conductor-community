version: '3.8'
services:
  community-conductor-api:
    build:
      context: ./conductor/conductor
      dockerfile: Dockerfile
    container_name: community-conductor-api
    restart: unless-stopped
    environment:
    - MONGO_INITDB_ROOT_USERNAME=admin
    - MONGO_INITDB_ROOT_PASSWORD=conductor123
    - MONGO_INITDB_DATABASE=conductor
    env_file:
    - ./config/conductor/.env
    volumes:
    - ./config/conductor/config.yaml:/app/config.yaml:ro
    - /var/run/docker.sock:/var/run/docker.sock:ro
    ports:
    - 12199:8000
    networks:
    - primoia-network
    - primoia-shared-infrastructure_primoia-infra-net
    extra_hosts:
    - primoia-mongodb:host-gateway
  community-conductor-mcp:
    build:
      context: ./conductor/conductor-gateway
      dockerfile: Dockerfile
    container_name: community-conductor-mcp
    restart: unless-stopped
    environment:
    - CONDUCTOR_API_URL=http://community-conductor-api:8000
    env_file:
    - ./config/gateway/.env
    volumes:
    - ./config/gateway/config.yaml:/app/config.yaml:ro
    ports:
    - 13199:8080
    depends_on:
    - community-conductor-api
    networks:
    - primoia-network
    - primoia-shared-infrastructure_primoia-infra-net
  community-conductor-web:
    build:
      context: ./conductor/conductor-web
      dockerfile: Dockerfile.angular
    container_name: community-conductor-web
    restart: unless-stopped
    volumes:
    - ./config/web/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
    - 11299:80
    depends_on:
    - community-conductor-mcp
    networks:
    - primoia-network
networks:
  primoia-network:
    driver: bridge
  primoia-shared-infrastructure_primoia-infra-net:
    external: true
